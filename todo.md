TODO:

- figure out how to properly count cached tokens
- go over entire flow of code, specifically paying attention to optimizations we made